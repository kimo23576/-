<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-i18n="main_title">ุญุงุณุจุฉ ุงูุจูุงุก - ููุตุฉ ุงูุงุชุญุงุฏ ุงูุนุงู ููููุงูููู ุงููููููู</title>
  <!-- Chart.js ูุฑุณู ุงูุฑุณูู ุงูุจูุงููุฉ -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- jsPDF ูุชูููุฏ ุชูุงุฑูุฑ PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- XLSX ูุชูุฒูู ูููุงุช Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
  <style>
    /* ุงููุชุบูุฑุงุช ุงูุฃุณุงุณูุฉ */
    :root {
      --primary-color: #8B4513;
      --secondary-color: #A0522D;
      --light-bg: #f4f4f4;
      --container-bg: #fff;
      --border-color: #aaa;
      --beige: rgba(245, 245, 220, 0.8);
    }
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--beige);
      color: #333;
      transition: background-color 0.3s, color 0.3s;
      direction: rtl;
      line-height: 1.6;
    }
    /* ุชูุณูู ุงูุญุงููุฉ ุงูุนุงูุฉ */
    .container {
      max-width: 1200px;
      margin: 20px auto;
      background-color: var(--container-bg);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      border: 1px solid #ddd;
    }
    /* ุชูุณูู ุงูููุฏุฑ */
    header {
      background-color: var(--primary-color);
      color: #fff;
      padding: 10px 20px;
      text-align: center;
    }
    header h2.main-title {
      margin: 5px 0 10px;
      font-size: 2rem;
      text-shadow: 1px 1px 2px #000;
    }
    .header-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 15px;
      padding: 0 10px;
    }
    .header-box {
      padding: 10px;
      text-align: center;
      border: 3px double var(--secondary-color);
      border-radius: 8px;
      background-color: #fff;
      transition: background-color 0.3s, transform 0.3s;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .header-box:hover {
      background-color: var(--light-bg);
      transform: scale(1.05);
    }
    .header-box .icon {
      font-size: 1.5rem;
      margin-bottom: 5px;
    }
    .header-box .title {
      font-size: 1rem;
      font-weight: bold;
      color: var(--primary-color);
    }
    /* ุชูุณูู ุงูุฃูุณุงู ูุงูุนูุงููู */
    h1, h2, h3 {
      text-align: center;
    }
    h1 {
      color: var(--primary-color);
      margin-bottom: 20px;
      font-size: 2rem;
    }
    h2 {
      color: var(--secondary-color);
      margin: 20px 0 10px;
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 10px;
      font-size: 1.5rem;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    input, select, button, textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1rem;
      box-sizing: border-box;
    }
    button {
      background-color: var(--primary-color);
      color: #fff;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: var(--secondary-color);
    }
    .instructions {
      background-color: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border: 1px solid #ddd;
      font-size: 0.95rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 0.9rem;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: var(--primary-color);
      color: #fff;
    }
    .total-row {
      font-weight: bold;
      background-color: #f4f4f4;
    }
    .share-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }
    .share-buttons button {
      padding: 10px 20px;
      font-size: 1rem;
      flex: 1 1 auto;
    }
    footer {
      background-color: var(--primary-color);
      color: #fff;
      text-align: center;
      padding: 10px 20px;
      font-size: 0.9rem;
    }
    /* ุงุณุชุนูุงูุงุช ุงููุณุงุฆุท ูุชุญุณูู ุงูุชุฌุงูุจ */
    @media (max-width: 768px) {
      header h2.main-title {
        font-size: 1.75rem;
      }
      .header-box .icon {
        font-size: 1.3rem;
      }
      .header-box .title {
        font-size: 0.9rem;
      }
      h1 {
        font-size: 1.75rem;
      }
      h2 {
        font-size: 1.3rem;
      }
      input, select, button, textarea {
        font-size: 0.9rem;
        padding: 8px;
      }
      .instructions {
        font-size: 0.85rem;
      }
    }
    @media (max-width: 576px) {
      .header-container {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 5px;
      }
      header, footer {
        padding: 8px 10px;
      }
      input, select, button, textarea {
        padding: 6px;
        font-size: 0.85rem;
      }
      .share-buttons button {
        font-size: 0.85rem;
      }
      h1 {
        font-size: 1.5rem;
      }
      h2 {
        font-size: 1.2rem;
      }
    }
    /* ุฃููุงุท ุงููุถุน ุงููููู */
    .dark-mode {
      background-color: #333;
      color: #ccc;
    }
    .dark-mode header {
      background-color: #222;
    }
    .dark-mode .container {
      background-color: #444;
    }
    .dark-mode table, .dark-mode th, .dark-mode td {
      border-color: #555;
    }
    .dark-mode th {
      background-color: #555;
      color: #fff;
    }
  </style>
</head>
<body>
  <!-- ุงูููุฏุฑ -->
  <header>
    <h2 class="main-title" data-i18n="main_title">ุญุงุณุจุฉ ุงูุจูุงุก ุงูุฐููุฉ</h2>
    <div class="header-container">
      <a class="header-box tab-link active" data-target="calculatorSection">
        <div class="icon">๐งฎ</div>
        <div class="title" data-i18n="calculator">ุงูุญุงุณุจุฉ</div>
      </a>
      <a class="header-box tab-link" data-target="advancedDetailsSection">
        <div class="icon">๐</div>
        <div class="title" data-i18n="advanced_details">ุงูุชูุงุตูู</div>
      </a>
      <a class="header-box tab-link" data-target="historySection">
        <div class="icon">๐</div>
        <div class="title" data-i18n="history">ุงูุณุฌู</div>
      </a>
      <a class="header-box tab-link" data-target="userManualSection">
        <div class="icon">๐</div>
        <div class="title" data-i18n="user_manual">ุงูุฏููู</div>
      </a>
      <a class="header-box tab-link" data-target="internationalStandardsSection">
        <div class="icon">๐</div>
        <div class="title" data-i18n="international_standards">ุงููุนุงููุฑ</div>
      </a>
      <a class="header-box tab-link" data-target="guidelinesSection">
        <div class="icon">๐ก</div>
        <div class="title" data-i18n="guidelines">ุงูุชูุฌููุงุช</div>
      </a>
      <a class="header-box" id="priceListBtn" href="https://guyc-yemen.com/price-guide/" target="_blank">
        <div class="icon">๐ท๏ธ</div>
        <div class="title" data-i18n="price_list">ุงูุฃุณุนุงุฑ</div>
      </a>
      <!-- ุฒุฑ ุงููุถุน ุงููููู -->
      <a class="header-box" id="darkModeToggle">
        <div class="icon">๐</div>
        <div class="title" data-i18n="dark_mode">ุงููุถุน ุงููููู</div>
      </a>
      <!-- ุฒุฑ ุชุจุฏูู ุงููุบุฉ -->
      <a class="header-box" id="languageToggle">
        <div class="icon">๐</div>
        <div class="title" data-i18n="language_toggle">English</div>
      </a>
    </div>
  </header>

  <!-- ุงููุญุชูู ุงูุฑุฆูุณู -->
  <main>
    <div class="container">
      <!-- ูุณู ุงูุญุงุณุจุฉ ุงูุฃุณุงุณู -->
      <section id="calculatorSection">
        <h1 data-i18n="main_title">ุญุงุณุจุฉ ุงูุจูุงุก ุงูุฐููุฉ </h1>
        <p style="text-align: center; color: #888;" data-i18n="result_description">
          ุชุนุชูุฏ ุงููุชุงุฆุฌ ุนูู ุฃุญุฏุซ ุงููุนุงููุฑ ุงูููุฏุณูุฉ ูุงูุจูุงูุงุช ุงูุญููููุฉ ููููุงุฏ ูุงูุฃุนูุงู.
        </p>
        <!-- ุจูุงูุงุช ุงููุดุฑูุน ุงูุฃุณุงุณูุฉ -->
        <div class="section">
          <h2 data-i18n="section_basic_data">ุจูุงูุงุช ุงููุดุฑูุน ุงูุฃุณุงุณูุฉ</h2>
          <div class="instructions" data-i18n="instructions_basic">
            ูุฑุฌู ุฅุฏุฎุงู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ูููุดุฑูุน ููุญุตูู ุนูู ุชูุฏูุฑ ุฃููู ููุชูููุฉ.
          </div>
          <label for="projectName" data-i18n="project_name">ุงุณู ุงููุดุฑูุน (ุงุฎุชูุงุฑู):</label>
          <input type="text" id="projectName" placeholder="ุฃุฏุฎู ุงุณู ุงููุดุฑูุน" />
          <label for="buildingType" data-i18n="building_type">ููุน ุงููุจูู:</label>
          <select id="buildingType">
            <option value="" data-i18n="choose_type"></option>
            <option value="residential" data-i18n="residential">ุณููู</option>
            <option value="commercial" data-i18n="commercial">ุชุฌุงุฑู</option>
            <option value="service" data-i18n="service">ุฎุฏูู</option>
            <option value="industrial" data-i18n="industrial">ุตูุงุนู</option>
            <option value="public" data-i18n="public">ุนุงู/ุญูููู</option>
          </select>
          <label for="detailedBuildingType" data-i18n="detailed_building_type">ุชุญุฏูุฏ ููุน ุงููุจูู:</label>
          <select id="detailedBuildingType">
            <option value="" data-i18n="choose_type"></option>
          </select>
          <div id="customDetailedBuildingTypeContainer" style="display:none;">
            <label for="customDetailedBuildingType" data-i18n="enter_custom_building">
              ุฃุฏุฎู ููุน ุงููุจูู ุงูุฎุงุต:
            </label>
            <input type="text" id="customDetailedBuildingType" placeholder="ุฃุฏุฎู ููุน ุงููุจูู" />
          </div>
          <label for="landArea" data-i18n="land_area">ุงููุณุงุญุฉ ุงููููุฉ ููุฃุฑุถ (ูยฒ):</label>
          <input type="number" id="landArea" placeholder="ุฃุฏุฎู ุงููุณุงุญุฉ ุงููููุฉ ููุฃุฑุถ" />
          <label for="builtArea" data-i18n="built_area">ูุณุงุญุฉ ุงูุจูุงุก (ูยฒ):</label>
          <input type="number" id="builtArea" placeholder="ุฃุฏุฎู ูุณุงุญุฉ ุงูุจูุงุก" />
          <label for="floors" data-i18n="number_of_floors">ุนุฏุฏ ุงูุฃุฏูุงุฑ ุงูุนูููุฉ:</label>
          <input type="number" id="floors" placeholder="ุฃุฏุฎู ุนุฏุฏ ุงูุฃุฏูุงุฑ" />
          <label for="structureType" data-i18n="structure_type">ููุน ุงููููู:</label>
          <select id="structureType">
            <option value="concrete" data-i18n="concrete">ุฎุฑุณุงูุฉ ูุณูุญุฉ</option>
            <option value="steel" data-i18n="steel">ูููู ุญุฏูุฏู</option>
            <option value="composite" data-i18n="composite">ูุฑูุจ</option>
            <option value="timber" data-i18n="timber">ุฎุดุจู</option>
          </select>
          <label for="constructionPhase" data-i18n="construction_phase">ูุฑุญูุฉ ุงูุจูุงุก ุงููุทููุจุฉ:</label>
          <select id="constructionPhase">
            <option value="all" data-i18n="all_phases">ุงููู (ุฌููุน ุงููุฑุงุญู)</option>
            <option value="foundation" data-i18n="foundation">ุฃุณุงุณุงุช</option>
            <option value="structure" data-i18n="structure">ุนุธู</option>
            <option value="finishing" data-i18n="finishing">ุชุดุทูุจ</option>
            <option value="electrical" data-i18n="electrical">ุฃุนูุงู ููุฑุจุงุฆูุฉ</option>
            <option value="plumbing" data-i18n="plumbing">ุฃุนูุงู ุณุจุงูุฉ</option>
            <option value="painting" data-i18n="painting">ุฃุนูุงู ุฏูุงู</option>
            <option value="tiling" data-i18n="tiling">ุฃุนูุงู ุจูุงุท</option>
            <option value="doors" data-i18n="doors">ุฃุจูุงุจ</option>
            <option value="windows" data-i18n="windows">ููุงูุฐ</option>
            <option value="flooring" data-i18n="flooring">ุฃุฑุถูุงุช</option>
          </select>
          <label for="currency" data-i18n="currency">ุงูุนููุฉ:</label>
          <select id="currency">
            <option value="YER">ุงูุฑูุงู ุงููููู (YER)</option>
            <option value="USD">ุงูุฏููุงุฑ ุงูุฃูุฑููู (USD)</option>
          </select>
          <label for="exchangeRate" data-i18n="exchange_rate">ุณุนุฑ ุงูุตุฑู (ุฑูุงู/ุฏููุงุฑ):</label>
          <input type="number" id="exchangeRate" placeholder="ุฃุฏุฎู ุณุนุฑ ุงูุตุฑู" />
          <label for="hasBasement" data-i18n="has_basement">ูู ููุฌุฏ ูุจู (ุจุฏุฑูู) ุ</label>
          <select id="hasBasement">
            <option value="no" data-i18n="no">ูุง</option>
            <option value="yes" data-i18n="yes">ูุนู</option>
          </select>
          <div id="basementContainer" style="display:none;">
            <label for="basementFloors" data-i18n="basement_floors">ุนุฏุฏ ุงูุฃุฏูุงุฑ ุชุญุช ุงูุฃุฑุถ:</label>
            <input type="number" id="basementFloors" placeholder="ุฃุฏุฎู ุนุฏุฏ ุฃุฏูุงุฑ ุงููุจู" />
          </div>
          <label for="floorHeight" data-i18n="floor_height">ุงุฑุชูุงุน ุงูุฏูุฑ (ูุชุฑ):</label>
          <input type="number" id="floorHeight" placeholder="ุฃุฏุฎู ุงุฑุชูุงุน ุงูุฏูุฑ ุจุงููุชุฑ" step="0.1" />
          <button id="calculateBtn" data-i18n="calculate_cost">ุงุญุณุจ ุงูุชูููุฉ</button>
          <button id="resetBtn" style="background-color:#555;" data-i18n="reset">ุฅุนุงุฏุฉ ุชุนููู</button>
        </div>
        <!-- ุนุฑุถ ุงููุชูุฌุฉ -->
        <div class="result" id="result">
          <h2 data-i18n="result">ุงููุชูุฌุฉ</h2>
          <p id="totalCost"></p>
          <div style="text-align:center;">
            <button id="generatePDFBtn" data-i18n="generate_pdf">ุชูููุฏ ุชูุฑูุฑ PDF</button>
          </div>
        </div>
        <div class="details" id="costDetailsContainer">
          <h3 data-i18n="cost_details">ุชูุงุตูู ุงูุชูููุฉ</h3>
          <ul id="costDetails"></ul>
        </div>
        <!-- ุชูุฏูุฑ ุงููููุงุช ุงููุทููุจุฉ -->
        <div class="section">
          <h2 data-i18n="quantities_required">ุชูุฏูุฑ ุงููููุงุช ุงููุทููุจุฉ</h2>
          <table id="quantityTable">
            <thead>
              <tr>
                <th data-i18n="material">ุงููุงุฏุฉ</th>
                <th data-i18n="required_quantity">ุงููููุฉ ุงููุทููุจุฉ</th>
                <th data-i18n="unit">ุงููุญุฏุฉ</th>
              </tr>
            </thead>
            <tbody>
              <!-- ูุชู ุชูููุฏ ุงูุตููู ุจุฑูุฌูุงู -->
            </tbody>
          </table>
        </div>
        <!-- ุชูููุฉ ูู ูุฑุญูุฉ -->
        <div class="section">
          <h2 data-i18n="phase_cost">ุชูููุฉ ูู ูุฑุญูุฉ</h2>
          <table id="phaseCostTable">
            <thead>
              <tr>
                <th data-i18n="phase">ุงููุฑุญูุฉ</th>
                <th data-i18n="cost">ุงูุชูููุฉ</th>
              </tr>
            </thead>
            <tbody>
              <!-- ูุชู ุชูููุฏ ุงูุตููู ุจุฑูุฌูุงู -->
            </tbody>
          </table>
        </div>
        <!-- ูุณู ุฌุฏูู ููููุงุช ุงููุจูู -->
        <div class="section" id="detailedElementsSection">
          <h2 data-i18n="building_components">ุฌุฏูู ููุถุญ ููููุงุช ุงููุจูู ููููุงุชูุง ูุชูููุชูุง</h2>
          <table id="detailedElementsTable">
            <thead>
              <tr>
                <th data-i18n="element">ุงูุนูุตุฑ</th>
                <th data-i18n="quantity">ุงููููุฉ</th>
                <th data-i18n="cost">ุงูุชูููุฉ</th>
              </tr>
            </thead>
            <tbody>
              <!-- ุณูุชู ุชุนุจุฆุชูุง ุจุฑูุฌูุงู -->
            </tbody>
          </table>
        </div>
        <!-- ูุณู ุงูุชูุฏูุฑุงุช ุงูุนุงูุฉ -->
        <div class="section" id="detailedCostSection">
          <h2 data-i18n="general_estimates">ุงูุชูุฏูุฑุงุช ุงูุนุงูุฉ</h2>
          <table id="detailedCostTable">
            <thead>
              <tr>
                <th data-i18n="item">ุงูุจูุฏ</th>
                <th data-i18n="cost">ุงูุชูููุฉ</th>
              </tr>
            </thead>
            <tbody>
              <!-- ุณูุชู ุชุนุจุฆุชูุง ุจุฑูุฌูุงู -->
            </tbody>
          </table>
        </div>
        <!-- ูุณู ุงูุฎูุงุตุฉ -->
        <div class="section" id="summarySection">
          <h2 data-i18n="summary">ุงูุฎูุงุตุฉ</h2>
          <p id="summaryTotalYER"></p>
          <p id="summaryTotalUSD"></p>
          <p id="summaryCostPerSqYER"></p>
          <p id="summaryCostPerSqUSD"></p>
        </div>
        <!-- ูุณู ุงูุญุณุงุจ ุงููุฏูู -->
        <div class="manual-price-calculator">
          <h2 data-i18n="manual_cost">ุญุณุงุจ ุงูุชูููุฉ ูููุง ูุฃุณุนุงุฑ ุฌุฏูุฏุฉ ููุนุฏูุฉ ูุฏูููุง</h2>
          <div class="instructions" data-i18n="manual_instructions">
            ููููู ุชุนุฏูู ุฃุณุนุงุฑ ุงูููุงุฏ ููููุงุชูุง ูุฏูููุง ุซู ุงูุถุบุท ุนูู "ุงุญุณุจ ุงูุชูููุฉ ุงููุฏููุฉ" ููุญุตูู ุนูู ุฅุฌูุงูู ุงูุชูููุฉ ุงูููุนุฏูู.
          </div>
          <table id="manualPriceTable">
            <thead>
              <tr>
                <th data-i18n="material">ุงููุงุฏุฉ</th>
                <th data-i18n="required_quantity">ุงููููุฉ ุงููุทููุจุฉ</th>
                <th data-i18n="unit">ุงููุญุฏุฉ</th>
                <th data-i18n="price">ุงูุณุนุฑ (ุฑูุงู)</th>
                <th data-i18n="total">ุงูุฅุฌูุงูู</th>
              </tr>
            </thead>
            <tbody>
              <!-- ูุชู ุชูููุฏ ุงูุตููู ุจุฑูุฌูุงู -->
            </tbody>
            <tfoot>
              <tr class="total-row">
                <td colspan="4" data-i18n="grand_total">ุงูุฅุฌูุงูู ุงูููู</td>
                <td id="manualTotalCost">0</td>
              </tr>
            </tfoot>
          </table>
          <button id="calculateManualBtn" data-i18n="calculate_manual">ุงุญุณุจ ุงูุชูููุฉ ุงููุฏููุฉ</button>
        </div>
        <!-- ูุณู ุงูุฑุณู ุงูุจูุงูู ูุชูุฒูุน ุงูุชูุงููู -->
        <div class="section">
          <h2 data-i18n="cost_chart">ุงูุฑุณู ุงูุจูุงูู ูุชูุฒูุน ุงูุชูุงููู</h2>
          <canvas id="costChart" style="max-width: 600px; margin: 0 auto;"></canvas>
        </div>
        <!-- ูุณู ุงูุฑุณููุงุช ุงูุจูุงููุฉ ุงูุฅุถุงููุฉ -->
        <div class="section" id="extraChartsSection">
          <h2 data-i18n="extra_charts">ุฑุณููุงุช ุจูุงููุฉ ุฅุถุงููุฉ</h2>
          <canvas id="extraChart1" style="max-width: 600px; margin: 0 auto 20px;"></canvas>
          <canvas id="extraChart2" style="max-width: 600px; margin: 0 auto 20px;"></canvas>
          <canvas id="extraChart3" style="max-width: 600px; margin: 0 auto 20px;"></canvas>
          <canvas id="extraChart4" style="max-width: 600px; margin: 0 auto;"></canvas>
        </div>
        <div class="share-buttons">
          <button id="shareBtn" data-i18n="share">ูุดุงุฑูุฉ ุนุจุฑ ุงููุงุชุณุงุจ</button>
          <button id="printBtn" data-i18n="print">ุทุจุงุนุฉ</button>
          <button id="downloadBtn" data-i18n="download_excel">ุชูุฒูู ููู Excel</button>
        </div>
      </section>

      <!-- ูุณู ุชูุงุตูู ุงููุดุฑูุน ุงููุชูุฏูุฉ -->
      <section id="advancedDetailsSection" style="display:none;">
        <h1 data-i18n="advanced_details">ุชูุงุตูู ุงููุดุฑูุน ุงููุชูุฏูุฉ</h1>
        <div class="instructions" data-i18n="advanced_instructions">
          ุฃุถู ุงูุชูุงุตูู ุงููุงููุฉ ูููุดุฑูุน ููุญุตูู ุนูู ุชูุฏูุฑ ุฏููู ูุดูู ุฌููุน ุงูุฌูุงูุจ ูููุงู ูุฃูุถู ุงููุนุงููุฑ ุงูุนุงูููุฉ.
        </div>
        <label for="projectLocation" data-i18n="project_location">ูููุน ุงููุดุฑูุน (ุงููุฏููุฉ/ุงูููุทูุฉ):</label>
        <input type="text" id="projectLocation" placeholder="ุฃุฏุฎู ูููุน ุงููุดุฑูุน" />
        <label for="projectLocationType" data-i18n="location_type">ููุน ุงููููุน:</label>
        <select id="projectLocationType">
          <option value="city" data-i18n="city">ูุฏููุฉ</option>
          <option value="rural" data-i18n="rural">ุฑูู</option>
          <option value="remote" data-i18n="remote">ููุทูุฉ ูุงุฆูุฉ</option>
          <option value="other" data-i18n="other">ุฃุฎุฑู</option>
        </select>
        <div id="customLocationContainer" style="display:none;">
          <label for="customLocation" data-i18n="custom_location">ุฃุฏุฎู ููุน ุงููููุน ุงูุฎุงุต:</label>
          <input type="text" id="customLocation" placeholder="ุฃุฏุฎู ููุน ุงููููุน" />
        </div>
        <label for="soilType" data-i18n="soil_type">ููุน ุงูุชุฑุจุฉ:</label>
        <select id="soilType">
          <option value="sandy" data-i18n="sandy">ุฑูููุฉ</option>
          <option value="mountainous" data-i18n="mountainous">ุฌุจููุฉ</option>
          <option value="rocky" data-i18n="rocky">ุตุฎุฑูุฉ</option>
          <option value="other" data-i18n="other">ุฃุฎุฑู</option>
        </select>
        <label for="residentialArea" data-i18n="residential_area">ูุณุงุญุฉ ุงููุณุงูู (ูยฒ):</label>
        <input type="number" id="residentialArea" placeholder="ุฃุฏุฎู ูุณุงุญุฉ ุงููุณุงูู" />
        <label for="servicesArea" data-i18n="services_area">ูุณุงุญุฉ ุงูุฎุฏูุงุช (ูยฒ):</label>
        <input type="number" id="servicesArea" placeholder="ุฃุฏุฎู ูุณุงุญุฉ ุงูุฎุฏูุงุช" />
        <label for="parkingArea" data-i18n="parking_area">ูุณุงุญุฉ ููุงูู ุงูุณูุงุฑุงุช (ูยฒ):</label>
        <input type="number" id="parkingArea" placeholder="ุฃุฏุฎู ูุณุงุญุฉ ููุงูู ุงูุณูุงุฑุงุช" />
        <label for="foundationType" data-i18n="foundation_type">ููุน ุงูุฃุณุงุณุงุช:</label>
        <select id="foundationType">
          <option value="shallow" data-i18n="shallow">ุฃุณุงุณุงุช ุณุทุญูุฉ</option>
          <option value="deep" data-i18n="deep">ุฃุณุงุณุงุช ุนูููุฉ</option>
          <option value="pile" data-i18n="pile">ุฃุณุงุณุงุช ุฑุตุงุตุฉ</option>
          <option value="special" data-i18n="special">ุฃุณุงุณุงุช ุฎุงุตุฉ</option>
        </select>
        <label for="finishQuality" data-i18n="finish_quality">ุฌูุฏุฉ ุงูุชุดุทูุจุงุช:</label>
        <select id="finishQuality">
          <option value="standard" data-i18n="standard">ููุงุณูุฉ</option>
          <option value="premium" data-i18n="premium">ูููุฒุฉ</option>
          <option value="luxury" data-i18n="luxury">ูุงุฎุฑุฉ</option>
        </select>
        <label for="constructionTime" data-i18n="construction_time">ุงููุฏุฉ ุงููุชููุนุฉ ููุชูููุฐ (ุจุงูุดููุฑ):</label>
        <input type="number" id="constructionTime" placeholder="ุฃุฏุฎู ุงููุฏุฉ ุงููุชููุนุฉ" />
        <label for="projectBudget" data-i18n="project_budget">ููุฒุงููุฉ ุงููุดุฑูุน (ุฑูุงู):</label>
        <input type="number" id="projectBudget" placeholder="ุฃุฏุฎู ุงูููุฒุงููุฉ ุงููุชููุนุฉ" />
        <label for="sustainability" data-i18n="sustainability">ุดูุงุฏุงุช ุงูุงุณุชุฏุงูุฉ ุงููุทููุจุฉ:</label>
        <select id="sustainability">
          <option value="none" data-i18n="none">ูุง ููุฌุฏ</option>
          <option value="leed" data-i18n="leed">LEED</option>
          <option value="breeam" data-i18n="breeam">BREEAM</option>
          <option value="other" data-i18n="other">ุฃุฎุฑู</option>
        </select>
        <label for="safetyStandards" data-i18n="safety_standards">ูุนุงููุฑ ุงูุฃูุงู ูุงูุณูุงูุฉ:</label>
        <textarea id="safetyStandards" placeholder="ุฃุฏุฎู ูุชุทูุจุงุช ููุนุงููุฑ ุงูุฃูุงู ูุงูุณูุงูุฉ ูููุดุฑูุน"></textarea>
        <button id="saveAdvancedBtn" data-i18n="save_advanced">ุญูุธ ุชูุงุตูู ุงููุดุฑูุน ุงููุชูุฏูุฉ</button>
      </section>

      <!-- ูุณู ุณุฌู ุงูุญุณุงุจุงุช ุงูุณุงุจูุฉ -->
      <section id="historySection" style="display:none;">
        <h1 data-i18n="history">ุณุฌู ุงูุญุณุงุจุงุช ุงูุณุงุจูุฉ</h1>
        <div class="instructions" data-i18n="history_instructions">
          ุชุณุชุนุฑุถ ุงููุงุฆูุฉ ุฃุฏูุงู ุขุฎุฑ ุงูุญุณุงุจุงุช ุงูุชู ุชู ุญูุธูุง ูู ุงููุชุตูุญ.
        </div>
        <ul id="historyList">
          <!-- ูุชู ุชูููุฏ ุงูุณุฌู ุจุฑูุฌูุงู -->
        </ul>
        <button id="clearHistoryBtn" style="background-color: #c0392b;" data-i18n="clear_history">ูุณุญ ุงูุณุฌู</button>
      </section>

      <!-- ูุณู ุฏููู ุงููุณุชุฎุฏู -->
      <section id="userManualSection" style="display:none;">
        <h1 data-i18n="user_manual">ุฏููู ุงููุณุชุฎุฏู</h1>
        <div class="instructions">
          <p data-i18n="manual_intro">
            ูููุฑ ุฏููู ุงููุณุชุฎุฏู ูุฐุง ุดุฑุญุงู ููุตูุงู ูููููุฉ ุงุณุชุฎุฏุงู ุงููุธุงู:
          </p>
          <ol>
            <li data-i18n="manual_step1">
              <strong data-i18n="manual_basic_data">ุจูุงูุงุช ุงููุดุฑูุน ุงูุฃุณุงุณูุฉ:</strong>
              ุฃุฏุฎู ุงุณู ุงููุดุฑูุน (ุงุฎุชูุงุฑู) ูููุน ุงููุจูู ูุน ุชุญุฏูุฏ ุงูููุน ุงูุฏููู (ูุซูุงู ูููุง ุฃู ุดูุฉ) ูุงููุณุงุญุงุช ูุนุฏุฏ ุงูุฃุฏูุงุฑ ูุฃููุงุน ุงูููููุ ุจุงูุฅุถุงูุฉ ุฅูู ุฎูุงุฑ ุงููุจู ูุงุฑุชูุงุน ุงูุฏูุฑ.
            </li>
            <li data-i18n="manual_step2">
              <strong data-i18n="manual_advanced">ุชูุงุตูู ุงููุดุฑูุน ุงููุชูุฏูุฉ:</strong>
              ุงูุชูู ุฅูู ูุฐุง ุงููุณู ูุฅุถุงูุฉ ุชูุงุตูู ุฅุถุงููุฉ ูุซู ุงููููุนุ ููุน ุงูุชุฑุจุฉุ ุชูุณูู ุงููุณุงุญุงุชุ ููุน ุงูุฃุณุงุณุงุชุ ุฌูุฏุฉ ุงูุชุดุทูุจุงุชุ ุงููุฏุฉุ ูุงูููุฒุงููุฉ.
            </li>
            <li data-i18n="manual_step3">
              <strong data-i18n="manual_result">ูุชุงุฆุฌ ุงูุญุณุงุจ:</strong>
              ูุชู ุนุฑุถ ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ ูุน ุชูุงุตูู ุชูููุฉ ูู ูุฑุญูุฉ ูุชูุฏูุฑ ุงููููุงุช ุงููุทููุจุฉุ ูุน ุฅููุงููุฉ ุชุนุฏูู ุงูุฃุณุนุงุฑ ูุงููููุงุช ูุฏููุงู.
            </li>
            <li data-i18n="manual_step4">
              <strong data-i18n="manual_reports">ุงูุชูุงุฑูุฑ ูุงูุฑุณูู ุงูุจูุงููุฉ:</strong>
              ูุนุฑุถ ุงููุธุงู ุฑุณููุงุช ุจูุงููุฉ ุชูุถุญ ุชูุฒูุน ูุชุทูุฑ ุงูุชูุงูููุ ูููููู ุชูููุฏ ุชูุฑูุฑ PDF ุฃู ุชูุฒูู ุงููุชุงุฆุฌ ูููู Excel.
            </li>
            <li data-i18n="manual_step5">
              <strong data-i18n="manual_history">ุณุฌู ุงูุญุณุงุจุงุช:</strong>
              ูุญุชูุธ ุงููุธุงู ุจุขุฎุฑ 10 ุญุณุงุจุงุช ุณุงุจูุฉ ูู ุงููุชุตูุญ ูุณูููุฉ ุงูุงุณุชุฑุฌุงุน.
            </li>
            <li data-i18n="manual_step6">
              <strong data-i18n="manual_components">ุงูุชูุงููู ุงูุชูุตูููุฉ ูููููุงุช ุงููุจูู:</strong>
              ูุธูุฑ ุฌุฏูู ููุถุญ ููููุงุช ุงููุจูู ููููุงุชูุง ูุชูุงููููุง ูููุงู ูููุนุงููุฑ ุงูููุฏุณูุฉ.
            </li>
          </ol>
        </div>
      </section>

      <!-- ูุณู ุงููุนุงููุฑ ุงูุฏูููุฉ ููุจูุงุก ูุงูุชุดููุฏ -->
      <section id="internationalStandardsSection" style="display:none;">
        <h1 data-i18n="international_standards">ุงููุนุงููุฑ ุงูุฏูููุฉ ููุจูุงุก ูุงูุชุดููุฏ</h1>
        <div class="instructions">
          <p data-i18n="standards_intro">
            ูุนุชูุฏ ูุฐุง ุงููุธุงู ุนูู ุฃูุถู ุงููุนุงููุฑ ุงูุนุงูููุฉ ูุถูุงู ุฌูุฏุฉ ุงูุชุตุงููู ูุฏูุฉ ุงูุญุณุงุจุงุช. ูููุง ููู ุจุนุถ ุงูุฅุฑุดุงุฏุงุช ูุงููุนุงููุฑ ุงููุณุชุฎุฏูุฉ:
          </p>
          <ul>
            <li><strong>ISO 9001:</strong> ูุธุงู ุฅุฏุงุฑุฉ ุงูุฌูุฏุฉ ูุถูุงู ุงูุงูุชุฒุงู ุจูุนุงููุฑ ุงูุฌูุฏุฉ ูู ูุงูุฉ ูุฑุงุญู ุงููุดุฑูุน.</li>
            <li><strong>ISO 14001:</strong> ูุธุงู ุงูุฅุฏุงุฑุฉ ุงูุจูุฆูุฉ ูุชูููู ุงูุขุซุงุฑ ุงูุจูุฆูุฉ ูููุดุงุฑูุน.</li>
            <li><strong>EN 1990 ู EN 1991:</strong> ูุนุงููุฑ ุงูุชุตููู ุงูุฅูุดุงุฆู ููุฃุญูุงู ูุงูููุฏุณุฉ.</li>
            <li><strong>ASTM & AISC:</strong> ูุนุงููุฑ ุงูุจูุงุก ุจุงุณุชุฎุฏุงู ุงููููุงุฐ ูุงูุฎุฑุณุงูุฉ ูุถูุงู ุงููุชุงูุฉ ูุงูุณูุงูุฉ.</li>
            <li><strong>LEED & BREEAM:</strong> ุฅุฑุดุงุฏุงุช ุชุตููู ุงููุจุงูู ุงูุฎุถุฑุงุก ูุถูุงู ุงุณุชุฏุงูุฉ ูููุงุกุฉ ุงูุทุงูุฉ.</li>
          </ul>
          <p data-i18n="standards_conclusion">
            ุชูุนุชุจุฑ ูุฐู ุงููุนุงููุฑ ุฅุทุงุฑุงู ุนุงูุงู ูุณุงูู ูู ุชุญุณูู ุฌูุฏุฉ ุงูุชุตุงููู ูุชูููู ุงููุฎุงุทุฑ ุงูุฅูุดุงุฆูุฉุ ููุง ุชุณุงุนุฏ ูู ุชุญููู ูุดุงุฑูุน ุชุชูุงุดู ูุน ุฃูุถู ุงูููุงุฑุณุงุช ุงูุนุงูููุฉ.
          </p>
        </div>
      </section>

      <!-- ูุณู ุฃูู ุงูุชูุฌููุงุช ูุงููุตุงุฆุญ -->
      <section id="guidelinesSection" style="display:none;">
        <h1 data-i18n="guidelines">ุฃูู ุงูุชูุฌููุงุช ูุงููุตุงุฆุญ</h1>
        <div class="instructions">
          <p data-i18n="guidelines_intro">
            ูููุง ููู ุจุนุถ ุงูุชูุฌููุงุช ูุงููุตุงุฆุญ ูุชูููุฐ ุงููุดุฑูุน ุจููุงุกุฉ ุนุงููุฉ ูุน ุถูุงู ุงูุงุณุชุฏุงูุฉ ูุชูููู ุงูุชูุงููู:
          </p>
          <ul>
            <li data-i18n="tip1">ุงูุชุฎุทูุท ุงููุณุจู ูุชุญุฏูุฏ ุฃูุฏุงู ูุงุถุญุฉ ูููุดุฑูุน ูุจู ุจุฏุก ุงูุชูููุฐ.</li>
            <li data-i18n="tip2">ุงุณุชุฎุฏุงู ููุงุฏ ุจูุงุก ุฐุงุช ุฌูุฏุฉ ุนุงููุฉ ูุจุฃุณุนุงุฑ ุชูุงูุณูุฉ ูุชูููู ุงููุฏุฑ.</li>
            <li data-i18n="tip3">ุงูุงุณุชูุงุฏุฉ ูู ุฃุญุฏุซ ุงูุชูููุงุช ูู ุฅุฏุงุฑุฉ ุงููุดุฑูุน ูุงูุชุตููู ุงูุฅูุดุงุฆู.</li>
            <li data-i18n="tip4">ุชุทุจูู ูุนุงููุฑ ุงูุงุณุชุฏุงูุฉ ูู ุงูุชุตููู ูุชุญููู ููุงุกุฉ ูู ุงุณุชููุงู ุงูุทุงูุฉ ูุงูููุงุฑุฏ.</li>
            <li data-i18n="tip5">ุงูุนูู ูุน ูุฑูู ูุชุฎุตุต ูู ุงูุฎุจุฑุงุก ูุถูุงู ุงูุงูุชุฒุงู ุจุงููุนุงููุฑ ุงูุฏูููุฉ.</li>
            <li data-i18n="tip6">ูุฑุงุฌุนุฉ ุงูุญุณุงุจุงุช ูุงูุชูุงุฑูุฑ ุจุงูุชุธุงู ูุชุญุฏูุฏ ุฃู ุงูุญุฑุงูุงุช ูุงุชุฎุงุฐ ุงูุฅุฌุฑุงุกุงุช ุงูุชุตุญูุญูุฉ.</li>
            <li data-i18n="tip7">ุชุทุจูู ุฃุณุงููุจ ุงูุจูุงุก ุงูุญุฏูุซุฉ ูุชูููู ุงูุชูุงููู ูุชุญุณูู ุฌูุฏุฉ ุงูุชูููุฐ.</li>
          </ul>
          <p data-i18n="guidelines_conclusion">
            ุจุงุชุจุงุน ูุฐู ุงููุตุงุฆุญุ ููููู ุชุญููู ูุดุฑูุน ูุงุฌุญ ููุณุชุฏุงู ูุน ุงูุญูุงุธ ุนูู ุงูุชูุงููู ุถูู ุงูุญุฏูุฏ ุงููุนูููุฉ.
          </p>
        </div>
      </section>
      
      <!-- ูุณู ูุนูููุงุช ุงูููุงุฏ ูุฎูู -->
      <section id="materialsSection" style="display:none;">
      </section>
    </div>
  </main>

  <footer>
    <p data-i18n="footer_text">&copy; 2025 ููุตุฉ ุงูุงุชุญุงุฏ ุงูุนุงู ููููุงูููู ุงููููููู. ุฌููุน ุงูุญููู ูุญููุธุฉ.</p>
  </footer>

  <script>
    // ุงููุชุบูุฑ ุงูุฎุงุต ุจุงููุบุฉ ุงูุญุงููุฉ (ุงูุชุฑุงุถู ุนุฑุจู)
    let currentLanguage = 'ar';
    // ูุงููุณ ุงูุชุฑุฌูุงุช ูููุตูุต ุงูุซุงุจุชุฉ
    const translations = {
      "main_title": { ar: "ุญุงุณุจุฉ ุงูุจูุงุก ุงูุฐููุฉ", en: "Smart Construction Calculator" },
      "calculator": { ar: "ุงูุญุงุณุจุฉ", en: "Calculator" },
      "advanced_details": { ar: "ุงูุชูุงุตูู", en: "Advanced Details" },
      "history": { ar: "ุงูุณุฌู", en: "History" },
      "user_manual": { ar: "ุงูุฏููู", en: "User Manual" },
      "international_standards": { ar: "ุงููุนุงููุฑ", en: "International Standards" },
      "guidelines": { ar: "ุงูุชูุฌููุงุช", en: "Guidelines" },
      "price_list": { ar: "ุงูุฃุณุนุงุฑ", en: "Price List" },
      "dark_mode": { ar: "ุงููุถุน ุงููููู", en: "Dark Mode" },
      "language_toggle": { ar: "English", en: "ุนุฑุจู" },
      "choose_type": { ar: "ุงุฎุชุฑ ุงูููุน", en: "Choose Type" },
      "section_basic_data": { ar: "ุจูุงูุงุช ุงููุดุฑูุน ุงูุฃุณุงุณูุฉ", en: "Project Basic Data" },
      "instructions_basic": { ar: "ูุฑุฌู ุฅุฏุฎุงู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ูููุดุฑูุน ููุญุตูู ุนูู ุชูุฏูุฑ ุฃููู ููุชูููุฉ.", en: "Please enter the basic project data to get an initial cost estimate." },
      "project_name": { ar: "ุงุณู ุงููุดุฑูุน (ุงุฎุชูุงุฑู):", en: "Project Name (Optional):" },
      "building_type": { ar: "ููุน ุงููุจูู:", en: "Building Type:" },
      "detailed_building_type": { ar: "ุชุญุฏูุฏ ููุน ุงููุจูู:", en: "Specify Building Type:" },
      "enter_custom_building": { ar: "ุฃุฏุฎู ููุน ุงููุจูู ุงูุฎุงุต:", en: "Enter Custom Building Type:" },
      "land_area": { ar: "ุงููุณุงุญุฉ ุงููููุฉ ููุฃุฑุถ (ูยฒ):", en: "Total Land Area (mยฒ):" },
      "built_area": { ar: "ูุณุงุญุฉ ุงูุจูุงุก (ูยฒ):", en: "Built Area (mยฒ):" },
      "number_of_floors": { ar: "ุนุฏุฏ ุงูุฃุฏูุงุฑ ุงูุนูููุฉ:", en: "Number of Floors:" },
      "structure_type": { ar: "ููุน ุงููููู:", en: "Structure Type:" },
      "concrete": { ar: "ุฎุฑุณุงูุฉ ูุณูุญุฉ", en: "Reinforced Concrete" },
      "steel": { ar: "ูููู ุญุฏูุฏู", en: "Steel Structure" },
      "composite": { ar: "ูุฑูุจ", en: "Composite" },
      "timber": { ar: "ุฎุดุจู", en: "Timber" },
      "construction_phase": { ar: "ูุฑุญูุฉ ุงูุจูุงุก ุงููุทููุจุฉ:", en: "Construction Phase:" },
      "all_phases": { ar: "ุงููู (ุฌููุน ุงููุฑุงุญู)", en: "All Phases" },
      "foundation": { ar: "ุฃุณุงุณุงุช", en: "Foundation" },
      "structure": { ar: "ุนุธู", en: "Structure" },
      "finishing": { ar: "ุชุดุทูุจ", en: "Finishing" },
      "electrical": { ar: "ุฃุนูุงู ููุฑุจุงุฆูุฉ", en: "Electrical Work" },
      "plumbing": { ar: "ุฃุนูุงู ุณุจุงูุฉ", en: "Plumbing" },
      "painting": { ar: "ุฃุนูุงู ุฏูุงู", en: "Painting" },
      "tiling": { ar: "ุฃุนูุงู ุจูุงุท", en: "Tiling" },
      "doors": { ar: "ุฃุจูุงุจ", en: "Doors" },
      "windows": { ar: "ููุงูุฐ", en: "Windows" },
      "flooring": { ar: "ุฃุฑุถูุงุช", en: "Flooring" },
      "currency": { ar: "ุงูุนููุฉ:", en: "Currency:" },
      "exchange_rate": { ar: "ุณุนุฑ ุงูุตุฑู (ุฑูุงู/ุฏููุงุฑ):", en: "Exchange Rate:" },
      "has_basement": { ar: "ูู ููุฌุฏ ูุจูุ", en: "Is there a Basement?" },
      "no": { ar: "ูุง", en: "No" },
      "yes": { ar: "ูุนู", en: "Yes" },
      "basement_floors": { ar: "ุนุฏุฏ ุงูุฃุฏูุงุฑ ุชุญุช ุงูุฃุฑุถ:", en: "Basement Floors:" },
      "floor_height": { ar: "ุงุฑุชูุงุน ุงูุฏูุฑ (ูุชุฑ):", en: "Floor Height (m):" },
      "calculate_cost": { ar: "ุงุญุณุจ ุงูุชูููุฉ", en: "Calculate Cost" },
      "reset": { ar: "ุฅุนุงุฏุฉ ุชุนููู", en: "Reset" },
      "result": { ar: "ุงููุชูุฌุฉ", en: "Result" },
      "generate_pdf": { ar: "ุชูููุฏ ุชูุฑูุฑ PDF", en: "Generate PDF Report" },
      "cost_details": { ar: "ุชูุงุตูู ุงูุชูููุฉ", en: "Cost Details" },
      "quantities_required": { ar: "ุชูุฏูุฑ ุงููููุงุช ุงููุทููุจุฉ", en: "Estimate Quantities" },
      "required_quantity": { ar: "ุงููููุฉ ุงููุทููุจุฉ", en: "Required Quantity" },
      "phase_cost": { ar: "ุชูููุฉ ูู ูุฑุญูุฉ", en: "Cost per Phase" },
      "phase": { ar: "ุงููุฑุญูุฉ", en: "Phase" },
      "item": { ar: "ุงูุจูุฏ", en: "Item" },
      "general_estimates": { ar: "ุงูุชูุฏูุฑุงุช ุงูุนุงูุฉ", en: "General Estimates" },
      "summary": { ar: "ุงูุฎูุงุตุฉ", en: "Summary" },
      "manual_cost": { ar: "ุญุณุงุจ ุงูุชูููุฉ ูููุง ูุฃุณุนุงุฑ ุฌุฏูุฏุฉ ููุนุฏูุฉ ูุฏูููุง", en: "Manual Cost Calculation" },
      "manual_instructions": { ar: "ููููู ุชุนุฏูู ุฃุณุนุงุฑ ุงูููุงุฏ ููููุงุชูุง ูุฏูููุง ุซู ุงูุถุบุท ุนูู \"ุงุญุณุจ ุงูุชูููุฉ ุงููุฏููุฉ\" ููุญุตูู ุนูู ุฅุฌูุงูู ุงูุชูููุฉ ุงูููุนุฏูู.", en: "You can manually adjust material prices and quantities then click \"Calculate Manual Cost\" to get the adjusted total cost." },
      "calculate_manual": { ar: "ุงุญุณุจ ุงูุชูููุฉ ุงููุฏููุฉ", en: "Calculate Manual Cost" },
      "cost_chart": { ar: "ุงูุฑุณู ุงูุจูุงูู ูุชูุฒูุน ุงูุชูุงููู", en: "Cost Distribution Chart" },
      "extra_charts": { ar: "ุฑุณููุงุช ุจูุงููุฉ ุฅุถุงููุฉ", en: "Additional Charts" },
      "share": { ar: "ูุดุงุฑูุฉ ุนุจุฑ ุงููุงุชุณุงุจ", en: "Share via WhatsApp" },
      "print": { ar: "ุทุจุงุนุฉ", en: "Print" },
      "download_excel": { ar: "ุชูุฒูู ููู Excel", en: "Download Excel File" },
      "project_location": { ar: "ูููุน ุงููุดุฑูุน (ุงููุฏููุฉ/ุงูููุทูุฉ):", en: "Project Location (City/Region):" },
      "location_type": { ar: "ููุน ุงููููุน:", en: "Location Type:" },
      "custom_location": { ar: "ุฃุฏุฎู ููุน ุงููููุน ุงูุฎุงุต:", en: "Enter Custom Location:" },
      "soil_type": { ar: "ููุน ุงูุชุฑุจุฉ:", en: "Soil Type:" },
      "sandy": { ar: "ุฑูููุฉ", en: "Sandy" },
      "mountainous": { ar: "ุฌุจููุฉ", en: "Mountainous" },
      "rocky": { ar: "ุตุฎุฑูุฉ", en: "Rocky" },
      "residential_area": { ar: "ูุณุงุญุฉ ุงููุณุงูู (ูยฒ):", en: "Residential Area (mยฒ):" },
      "services_area": { ar: "ูุณุงุญุฉ ุงูุฎุฏูุงุช (ูยฒ):", en: "Services Area (mยฒ):" },
      "parking_area": { ar: "ูุณุงุญุฉ ููุงูู ุงูุณูุงุฑุงุช (ูยฒ):", en: "Parking Area (mยฒ):" },
      "foundation_type": { ar: "ููุน ุงูุฃุณุงุณุงุช:", en: "Foundation Type:" },
      "shallow": { ar: "ุฃุณุงุณุงุช ุณุทุญูุฉ", en: "Shallow" },
      "deep": { ar: "ุฃุณุงุณุงุช ุนูููุฉ", en: "Deep" },
      "pile": { ar: "ุฃุณุงุณุงุช ุฑุตุงุตุฉ", en: "Pile" },
      "special": { ar: "ุฃุณุงุณุงุช ุฎุงุตุฉ", en: "Special" },
      "finish_quality": { ar: "ุฌูุฏุฉ ุงูุชุดุทูุจุงุช:", en: "Finish Quality:" },
      "standard": { ar: "ููุงุณูุฉ", en: "Standard" },
      "premium": { ar: "ูููุฒุฉ", en: "Premium" },
      "luxury": { ar: "ูุงุฎุฑุฉ", en: "Luxury" },
      "construction_time": { ar: "ุงููุฏุฉ ุงููุชููุนุฉ ููุชูููุฐ (ุจุงูุดููุฑ):", en: "Expected Construction Time (months):" },
      "project_budget": { ar: "ููุฒุงููุฉ ุงููุดุฑูุน (ุฑูุงู):", en: "Project Budget (Local Currency):" },
      "sustainability": { ar: "ุดูุงุฏุงุช ุงูุงุณุชุฏุงูุฉ ุงููุทููุจุฉ:", en: "Sustainability Certifications:" },
      "none": { ar: "ูุง ููุฌุฏ", en: "None" },
      "leed": { ar: "LEED", en: "LEED" },
      "breeam": { ar: "BREEAM", en: "BREEAM" },
      "safety_standards": { ar: "ูุนุงููุฑ ุงูุฃูุงู ูุงูุณูุงูุฉ:", en: "Safety Standards:" },
      "save_advanced": { ar: "ุญูุธ ุชูุงุตูู ุงููุดุฑูุน ุงููุชูุฏูุฉ", en: "Save Advanced Project Details" },
      "history_instructions": { ar: "ุชุณุชุนุฑุถ ุงููุงุฆูุฉ ุฃุฏูุงู ุขุฎุฑ ุงูุญุณุงุจุงุช ุงูุชู ุชู ุญูุธูุง ูู ุงููุชุตูุญ.", en: "Below is a list of the last 10 saved calculations." },
      "clear_history": { ar: "ูุณุญ ุงูุณุฌู", en: "Clear History" },
      "footer_text": { ar: "ยฉ 2025 ููุตุฉ ุงูุงุชุญุงุฏ ุงูุนุงู ููููุงูููู ุงููููููู. ุฌููุน ุงูุญููู ูุญููุธุฉ.", en: "ยฉ 2025 Yemeni Contractors Association Platform. All rights reserved." }
    };

    // ุฏุงูุฉ ุชุทุจูู ุงูุชุฑุฌูุฉ ุนูู ูุงูุฉ ุงูุนูุงุตุฑ ุงูุชู ุชุญูู data-i18n
    function translatePage() {
      document.querySelectorAll('[data-i18n]').forEach(elem => {
        const key = elem.getAttribute('data-i18n');
        if (translations[key] && translations[key][currentLanguage]) {
          elem.innerText = translations[key][currentLanguage];
        }
      });
    }

    // ุฏุงูุฉ ุชุจุฏูู ุงููุบุฉ
    function toggleLanguage() {
      currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
      const languageToggle = document.getElementById('languageToggle');
      const langTitle = languageToggle.querySelector('.title');
      langTitle.innerText = translations["language_toggle"][currentLanguage];
      document.body.setAttribute('dir', currentLanguage === 'ar' ? 'rtl' : 'ltr');
      translatePage();
    }

    document.addEventListener('DOMContentLoaded', () => {
      /* ===== ุงูุชุจููุจุงุช ===== */
      const tabLinks = document.querySelectorAll('.tab-link');
      const sections = document.querySelectorAll('main section');
      tabLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          tabLinks.forEach(l => l.classList.remove('active'));
          link.classList.add('active');
          const target = link.getAttribute('data-target');
          sections.forEach(sec => {
            sec.style.display = sec.id === target ? 'block' : 'none';
          });
        });
      });

      /* ===== ุนูุงุตุฑ ูุณู ุงูุญุงุณุจุฉ ุงูุฃุณุงุณูุฉ ===== */
      const projectNameEl = document.getElementById('projectName');
      const buildingTypeEl = document.getElementById('buildingType');
      const detailedBuildingTypeEl = document.getElementById('detailedBuildingType');
      const customDetailedBuildingTypeEl = document.getElementById('customDetailedBuildingType');
      const customDetailedBuildingTypeContainer = document.getElementById('customDetailedBuildingTypeContainer');
      const landAreaEl = document.getElementById('landArea');
      const builtAreaEl = document.getElementById('builtArea');
      const floorsEl = document.getElementById('floors');
      const structureTypeEl = document.getElementById('structureType');
      const constructionPhaseEl = document.getElementById('constructionPhase');
      const currencyEl = document.getElementById('currency');
      const exchangeRateEl = document.getElementById('exchangeRate');
      const totalCostEl = document.getElementById('totalCost');
      const costDetailsEl = document.getElementById('costDetails');
      const quantityTableBody = document.querySelector('#quantityTable tbody');
      const phaseCostTableBody = document.querySelector('#phaseCostTable tbody');
      const manualPriceTableBody = document.getElementById('manualPriceTable').querySelector('tbody');
      const manualTotalCostEl = document.getElementById('manualTotalCost');

      const calculateBtn = document.getElementById('calculateBtn');
      const resetBtn = document.getElementById('resetBtn');
      const calculateManualBtn = document.getElementById('calculateManualBtn');
      const shareBtn = document.getElementById('shareBtn');
      const printBtn = document.getElementById('printBtn');
      const downloadBtn = document.getElementById('downloadBtn');
      const generatePDFBtn = document.getElementById('generatePDFBtn');

      /* ===== ุนูุงุตุฑ ุฎูุงุฑ ุงููุจู ===== */
      const hasBasementEl = document.getElementById('hasBasement');
      const basementContainer = document.getElementById('basementContainer');
      const basementFloorsEl = document.getElementById('basementFloors');

      /* ===== ุนูุงุตุฑ ุชุญุฏูุฏ ุงุฑุชูุงุน ุงูุฏูุฑ ===== */
      const floorHeightEl = document.getElementById('floorHeight');

      /* ===== ุนูุงุตุฑ ูุณู ุงูุชูุงุตูู ุงููุชูุฏูุฉ ===== */
      const projectLocationEl = document.getElementById('projectLocation');
      const projectLocationTypeEl = document.getElementById('projectLocationType');
      const customLocationContainer = document.getElementById('customLocationContainer');
      const soilTypeEl = document.getElementById('soilType');
      const residentialAreaEl = document.getElementById('residentialArea');
      const servicesAreaEl = document.getElementById('servicesArea');
      const parkingAreaEl = document.getElementById('parkingArea');
      const foundationTypeEl = document.getElementById('foundationType');
      const finishQualityEl = document.getElementById('finishQuality');
      const constructionTimeEl = document.getElementById('constructionTime');
      const projectBudgetEl = document.getElementById('projectBudget');
      const sustainabilityEl = document.getElementById('sustainability');
      const safetyStandardsEl = document.getElementById('safetyStandards');
      const saveAdvancedBtn = document.getElementById('saveAdvancedBtn');

      /* ===== ูุณู ุนุฑุถ ุงูุชูุงููู ุงูุชูุตูููุฉ ===== */
      const detailedCostTableBody = document.querySelector('#detailedCostTable tbody');

      /* ===== ูุณู ุฌุฏูู ููููุงุช ุงููุจูู ===== */
      const detailedElementsTableBody = document.querySelector('#detailedElementsTable tbody');

      /* ===== ูุณู ุงูุฎูุงุตุฉ ===== */
      const summaryTotalYEREl = document.getElementById('summaryTotalYER');
      const summaryTotalUSDEl = document.getElementById('summaryTotalUSD');
      const summaryCostPerSqYEREl = document.getElementById('summaryCostPerSqYER');
      const summaryCostPerSqUSDEl = document.getElementById('summaryCostPerSqUSD');

      /* ===== ุนูุงุตุฑ ุงูุฑุณููุงุช ุงูุจูุงููุฉ ===== */
      const costChartCanvas = document.getElementById('costChart');
      const extraChart1Canvas = document.getElementById('extraChart1');
      const extraChart2Canvas = document.getElementById('extraChart2');
      const extraChart3Canvas = document.getElementById('extraChart3');
      const extraChart4Canvas = document.getElementById('extraChart4');

      /* ===== ุจูุงูุงุช ุงูุฃุณุนุงุฑ ุงูุงูุชุฑุงุถูุฉ ููุตูููุฉ ุงูููุงุฏ ===== */
      let materialPrices = {
        concrete: 5000,
        steel: 80000,
        cement: 6000,
        bricks: 500,
        blocks: 300,
        paint: 100,
        tiles: 200,
        doors: 5000,
        windows: 3000,
        flooring: 150
      };

      const materials = [
        { name: 'ุงูุฎุฑุณุงูุฉ', key: 'concrete', unit: 'ูยณ' },
        { name: 'ุงูุญุฏูุฏ', key: 'steel', unit: 'ุทู' },
        { name: 'ุงูุฃุณููุช', key: 'cement', unit: 'ุทู' },
        { name: 'ุงูุทูุจ', key: 'bricks', unit: 'ุทูุจุฉ' },
        { name: 'ุงูุจููู', key: 'blocks', unit: 'ุจููู' },
        { name: 'ุงูุฏูุงู', key: 'paint', unit: 'ูุชุฑ' },
        { name: 'ุงูุจูุงุท', key: 'tiles', unit: 'ูยฒ' },
        { name: 'ุงูุฃุจูุงุจ', key: 'doors', unit: 'ุจุงุจ' },
        { name: 'ุงูููุงูุฐ', key: 'windows', unit: 'ูุงูุฐุฉ' },
        { name: 'ุงูุฃุฑุถูุงุช', key: 'flooring', unit: 'ูยฒ' }
      ];

      /* ===== ูุนุงููุฑ ุชูููุฉ ุงูุจูุงุก ุจุนุฏ ุฑูุน ุงูุชูููุฉ ุจูุณุจุฉ 100% ===== */
      const buildingCosts = {
        residential: {
          foundation: 25000,
          structure: 75000,
          finishing: 50000,
          electrical: 10000,
          plumbing: 7500,
          painting: 5000,
          tiling: 12500,
          doors: 2500,
          windows: 1500,
          flooring: 7500
        },
        commercial: {
          foundation: 30000,
          structure: 90000,
          finishing: 60000,
          electrical: 12500,
          plumbing: 10000,
          painting: 7500,
          tiling: 15000,
          doors: 3000,
          windows: 2000,
          flooring: 10000
        },
        service: {
          foundation: 35000,
          structure: 100000,
          finishing: 75000,
          electrical: 15000,
          plumbing: 12500,
          painting: 10000,
          tiling: 17500,
          doors: 3500,
          windows: 2500,
          flooring: 12500
        },
        industrial: {
          foundation: 40000,
          structure: 125000,
          finishing: 75000,
          electrical: 15000,
          plumbing: 12500,
          painting: 7500,
          tiling: 15000,
          doors: 3500,
          windows: 2500,
          flooring: 10000
        },
        public: {
          foundation: 37500,
          structure: 110000,
          finishing: 65000,
          electrical: 14000,
          plumbing: 11000,
          painting: 6000,
          tiling: 14000,
          doors: 3250,
          windows: 2250,
          flooring: 9000
        }
      };

      async function fetchPrices() {
        try {
          const response = await fetch('https://guyc-yemen.com/price-guide/');
          if (!response.ok) throw new Error("ูุดู ูู ุฌูุจ ุงูุจูุงูุงุช ูู ุงูุฎุงุฏู");
          const data = await response.json();
          if (data.prices) materialPrices = data.prices;
        } catch (error) {
          console.warn("ุชุนุฐุฑ ุฌูุจ ุงูุฃุณุนุงุฑ ูู ุงูุฎุงุฏู. ุณูุชู ุงุณุชุฎุฏุงู ุงูุฃุณุนุงุฑ ุงูุงูุชุฑุงุถูุฉ.");
        }
      }

      buildingTypeEl.addEventListener('change', () => {
        let options = '<option value="" data-i18n="choose_type"></option>';
        switch(buildingTypeEl.value) {
          case 'residential':
            options += `<option value="ูููุง">ูููุง</option>
                        <option value="ุดูุฉ">ุดูุฉ</option>
                        <option value="ููุฒู ุดุนุจู">ููุฒู ุดุนุจู</option>
                        <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>`;
            break;
          case 'commercial':
            options += `<option value="ูุญู">ูุญู</option>
                        <option value="ูุณุชูุฏุน">ูุณุชูุฏุน</option>
                        <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>`;
            break;
          case 'service':
            options += `<option value="ูุฏุฑุณุฉ">ูุฏุฑุณุฉ</option>
                        <option value="ูุณุชุดูู">ูุณุชุดูู</option>
                        <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>`;
            break;
          case 'industrial':
            options += `<option value="ูุตูุน">ูุตูุน</option>
                        <option value="ูุฎุฒู">ูุฎุฒู</option>
                        <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>`;
            break;
          case 'public':
            options += `<option value="ูุจูู ุญูููู">ูุจูู ุญูููู</option>
                        <option value="ููุดุฃุฉ ุนุงูุฉ">ููุดุฃุฉ ุนุงูุฉ</option>
                        <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>`;
            break;
          default:
            options = '<option value="" data-i18n="choose_type"></option>';
        }
        detailedBuildingTypeEl.innerHTML = options;
      });

      detailedBuildingTypeEl.addEventListener('change', () => {
        if(detailedBuildingTypeEl.value === "ุฃุฎุฑู") {
          customDetailedBuildingTypeContainer.style.display = 'block';
        } else {
          customDetailedBuildingTypeContainer.style.display = 'none';
        }
      });

      function estimateQuantities(builtArea, floors, structureType, floorHeight = 3) {
        let multiplier = floorHeight / 3;
        let quantities = {
          concrete: builtArea * 0.2 * floors * multiplier,
          steel: builtArea * 0.05 * floors * multiplier,
          cement: builtArea * 0.1 * floors * multiplier,
          bricks: builtArea * 100 * floors * multiplier,
          blocks: builtArea * 50 * floors * multiplier,
          paint: builtArea * 0.5 * floors * multiplier,
          tiles: builtArea * floors * multiplier,
          doors: (builtArea / 10) * floors * multiplier,
          windows: (builtArea / 10) * floors * multiplier,
          flooring: builtArea * floors * multiplier
        };
        if (structureType === "steel") {
          quantities.concrete = builtArea * 0.1 * floors * multiplier;
          quantities.steel = builtArea * 0.1 * floors * multiplier;
        }
        for (let key in quantities) {
          quantities[key] = parseFloat(quantities[key].toFixed(2));
        }
        return quantities;
      }

      function calculateCost() {
        const builtArea = parseFloat(builtAreaEl.value);
        if (!builtArea || builtArea <= 0) {
          alert("ุงูุฑุฌุงุก ุฅุฏุฎุงู ูุณุงุญุฉ ุจูุงุก ุตุญูุญุฉ.");
          return;
        }
        const floors = parseFloat(floorsEl.value) || 1;
        const floorHeight = parseFloat(floorHeightEl.value) || 3;
        const structureType = structureTypeEl.value;
        const buildingType = buildingTypeEl.value;
        const constructionPhase = constructionPhaseEl.value;
        const currency = currencyEl.value;
        const exchangeRate = parseFloat(exchangeRateEl.value) || 1;

        let phaseCosts = {
          foundation: buildingCosts[buildingType].foundation * builtArea * floors,
          structure: buildingCosts[buildingType].structure * builtArea * floors,
          finishing: buildingCosts[buildingType].finishing * builtArea * floors,
          electrical: buildingCosts[buildingType].electrical * builtArea * floors,
          plumbing: buildingCosts[buildingType].plumbing * builtArea * floors,
          painting: buildingCosts[buildingType].painting * builtArea * floors,
          tiling: buildingCosts[buildingType].tiling * builtArea * floors,
          doors: buildingCosts[buildingType].doors * builtArea * floors,
          windows: buildingCosts[buildingType].windows * builtArea * floors,
          flooring: buildingCosts[buildingType].flooring * builtArea * floors
        };
        if (structureType === "steel") {
          phaseCosts.structure = (buildingCosts[buildingType].structure * 1.2) * builtArea * floors;
        }
        let foundationMultiplier = 1;
        if (foundationTypeEl) {
          switch(foundationTypeEl.value) {
            case "deep": foundationMultiplier = 1.2; break;
            case "pile": foundationMultiplier = 1.3; break;
            case "special": foundationMultiplier = 1.4; break;
            default: foundationMultiplier = 1;
          }
          phaseCosts.foundation *= foundationMultiplier;
        }
        let finishMultiplier = 1;
        if (finishQualityEl) {
          switch(finishQualityEl.value) {
            case "premium": finishMultiplier = 1.15; break;
            case "luxury": finishMultiplier = 1.3; break;
            default: finishMultiplier = 1;
          }
          phaseCosts.finishing *= finishMultiplier;
        }
        let basementCost = 0;
        if (hasBasementEl.value === "yes") {
          let basementFloors = parseFloat(basementFloorsEl.value) || 0;
          basementCost = basementFloors * builtArea * 200;
          phaseCosts['basement'] = basementCost;
        }
        if (soilTypeEl) {
          let soilType = soilTypeEl.value;
          let soilMultiplier = 0;
          if (soilType === "sandy") soilMultiplier = 0.1;
          else if (soilType === "mountainous") soilMultiplier = 0.15;
          else if (soilType === "rocky") soilMultiplier = 0.2;
          else soilMultiplier = 0.1;
          phaseCosts.foundation *= (1 + soilMultiplier);
        }
        if (projectLocationTypeEl) {
          let locationType = projectLocationTypeEl.value;
          let locationMultiplier = 1;
          if (locationType === "rural") locationMultiplier = 0.95;
          else if (locationType === "remote") locationMultiplier = 1.1;
          else locationMultiplier = 1;
          for (let phase in phaseCosts) {
            phaseCosts[phase] *= locationMultiplier;
          }
        }
        let totalCost = 0;
        let selectedPhaseCosts = {};
        if (constructionPhase === "all") {
          totalCost = Object.values(phaseCosts).reduce((sum, cost) => sum + cost, 0);
          selectedPhaseCosts = phaseCosts;
        } else {
          totalCost = phaseCosts[constructionPhase];
          selectedPhaseCosts[constructionPhase] = phaseCosts[constructionPhase];
        }
        if (currency === 'USD') {
          totalCost /= exchangeRate;
          for (let phase in selectedPhaseCosts) {
            selectedPhaseCosts[phase] /= exchangeRate;
          }
        }
        totalCostEl.innerText = `ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ: ${totalCost.toLocaleString()} ${currency}`;
        const phaseNames = {
          foundation: "ุงูุฃุณุงุณุงุช",
          structure: "ุงููููู",
          finishing: "ุงูุชุดุทูุจุงุช",
          electrical: "ุงูููุฑุจุงุก",
          plumbing: "ุงูุณุจุงูุฉ",
          painting: "ุงูุฏูุงู",
          tiling: "ุงูุจูุงุท",
          doors: "ุงูุฃุจูุงุจ",
          windows: "ุงูููุงูุฐ",
          flooring: "ุงูุฃุฑุถูุงุช",
          basement: "ุงููุจู"
        };
        costDetailsEl.innerHTML = Object.keys(selectedPhaseCosts).map(phase => 
          `<li>${phaseNames[phase]}: ${selectedPhaseCosts[phase].toLocaleString()} ${currency}</li>`
        ).join("");
        const quantities = estimateQuantities(builtArea, floors, structureType, floorHeight);
        quantityTableBody.innerHTML = materials.map(mat => `
          <tr>
            <td>${mat.name}</td>
            <td>${quantities[mat.key]}</td>
            <td>${mat.unit}</td>
          </tr>
        `).join("");
        phaseCostTableBody.innerHTML = Object.keys(selectedPhaseCosts).map(phase => `
          <tr>
            <td>${phaseNames[phase]}</td>
            <td>${selectedPhaseCosts[phase].toLocaleString()} ${currency}</td>
          </tr>
        `).join("");
        updateManualPriceTable(quantities);
        updateCostChart(selectedPhaseCosts, currency);
        updateDetailedElementsTable(selectedPhaseCosts, currency);
        updateSummary(totalCost, builtArea, currency, exchangeRate);
        updateAllExtraCharts(selectedPhaseCosts, currency);
        
        let planningCost = 0.1 * totalCost;
        let profitMargin = 0.1 * totalCost;
        let materialCost = 0;
        for (let key in quantities) {
          if(materialPrices[key]) {
            materialCost += quantities[key] * materialPrices[key];
          }
        }
        let laborCost = totalCost - (planningCost + profitMargin + materialCost);
        let generalEstimatesHTML = `
          <tr>
            <td>ุชูุงููู ุงูุชุฎุทูุท ูุงูุชุตููู</td>
            <td>${planningCost.toLocaleString()} ${currency}</td>
          </tr>
          <tr>
            <td>ูููุฉ ุงูููุงุฏ</td>
            <td>${materialCost.toLocaleString()} ${currency}</td>
          </tr>
          <tr>
            <td>ุชูุงููู ุงูุฃูุฏู ุงูุนุงููุฉ</td>
            <td>${laborCost.toLocaleString()} ${currency}</td>
          </tr>
          <tr>
            <td>ูุงูุด ุงูุฑุจุญ</td>
            <td>${profitMargin.toLocaleString()} ${currency}</td>
          </tr>
          <tr class="total-row">
            <td>ุงูุฅุฌูุงูู ุงูููู</td>
            <td>${totalCost.toLocaleString()} ${currency}</td>
          </tr>
        `;
        document.querySelector('#detailedCostTable tbody').innerHTML = generalEstimatesHTML;
        
        saveCalculation({
          projectName: projectNameEl.value || "ุบูุฑ ูุญุฏุฏ",
          buildingType: buildingTypeEl.value,
          builtArea, floors, structureType, constructionPhase,
          currency, exchangeRate,
          totalCost,
          advancedDetails: {
            projectLocation: projectLocationEl ? projectLocationEl.value : "",
            projectLocationType: projectLocationTypeEl ? projectLocationTypeEl.value : "",
            soilType: soilTypeEl ? soilTypeEl.value : "",
            residentialArea: residentialAreaEl ? parseFloat(residentialAreaEl.value) : 0,
            servicesArea: servicesAreaEl ? parseFloat(servicesAreaEl.value) : 0,
            parkingArea: parkingAreaEl ? parseFloat(parkingAreaEl.value) : 0,
            foundationType: foundationTypeEl ? foundationTypeEl.value : "",
            finishQuality: finishQualityEl ? finishQualityEl.value : "",
            constructionTime: constructionTimeEl ? parseFloat(constructionTimeEl.value) : 0,
            projectBudget: projectBudgetEl ? parseFloat(projectBudgetEl.value) : 0,
            sustainability: sustainabilityEl ? sustainabilityEl.value : "",
            safetyStandards: safetyStandardsEl ? safetyStandardsEl.value : "",
            landArea: landAreaEl ? parseFloat(landAreaEl.value) : 0,
            builtArea: builtArea,
            hasBasement: hasBasementEl ? hasBasementEl.value : "no",
            basementFloors: basementFloorsEl ? parseFloat(basementFloorsEl.value) : 0,
            floorHeight: floorHeight,
          },
          timestamp: new Date().toLocaleString()
        });
      }

      function updateManualPriceTable(quantities) {
        manualPriceTableBody.innerHTML = materials.map(mat => `
          <tr>
            <td>${mat.name}</td>
            <td><input type="number" id="manualQty_${mat.key}" value="${quantities[mat.key]}" style="width:60px;" /></td>
            <td>${mat.unit}</td>
            <td><input type="number" id="manualPrice_${mat.key}" placeholder="ุฃุฏุฎู ุงูุณุนุฑ" /></td>
            <td id="manualTotal_${mat.key}">0</td>
          </tr>
        `).join("");
      }

      function calculateManualCost() {
        let totalManualCost = 0;
        materials.forEach((mat, index) => {
          const qty = parseFloat(document.getElementById(`manualQty_${mat.key}`).value) || 0;
          const price = parseFloat(document.getElementById(`manualPrice_${mat.key}`).value) || 0;
          const total = qty * price;
          document.getElementById(`manualTotal_${mat.key}`).innerText = total.toLocaleString();
          totalManualCost += total;
        });
        manualTotalCostEl.innerText = totalManualCost.toLocaleString();
      }

      let costChart;
      function updateCostChart(phaseCosts, currency) {
        const ctx = costChartCanvas.getContext('2d');
        const labels = Object.keys(phaseCosts).map(key => {
          const map = {
            foundation: "ุงูุฃุณุงุณุงุช",
            structure: "ุงููููู",
            finishing: "ุงูุชุดุทูุจุงุช",
            electrical: "ุงูููุฑุจุงุก",
            plumbing: "ุงูุณุจุงูุฉ",
            painting: "ุงูุฏูุงู",
            tiling: "ุงูุจูุงุท",
            doors: "ุงูุฃุจูุงุจ",
            windows: "ุงูููุงูุฐ",
            flooring: "ุงูุฃุฑุถูุงุช",
            basement: "ุงููุจู"
          };
          return map[key] || key;
        });
        const dataValues = Object.values(phaseCosts);
        if (costChart) {
          costChart.data.labels = labels;
          costChart.data.datasets[0].data = dataValues;
          costChart.options.plugins.title.text = `ุชูุฒูุน ุงูุชูุงููู (${currency})`;
          costChart.update();
        } else {
          costChart = new Chart(ctx, {
            type: 'pie',
            data: {
              labels: labels,
              datasets: [{
                label: 'ุชูููุฉ ูู ูุฑุญูุฉ',
                data: dataValues,
                backgroundColor: [
                  '#ff6384', '#36a2eb', '#ffce56', '#4bc0c0', '#9966ff',
                  '#ff9f40', '#c9cbcf', '#8B4513', '#A0522D', '#2ecc71',
                  '#7f8c8d'
                ]
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { position: 'bottom' },
                title: {
                  display: true,
                  text: `ุชูุฒูุน ุงูุชูุงููู (${currency})`
                }
              }
            }
          });
        }
      }

      function updateDetailedElementsTable(phaseCosts, currency) {
        const builtAreaVal = parseFloat(builtAreaEl.value);
        const floorsVal = parseFloat(floorsEl.value) || 1;
        const q1 = builtAreaVal * floorsVal * 0.1;
        const c1 = phaseCosts.foundation ? phaseCosts.foundation * 0.6 : 0;
        const q2 = builtAreaVal * floorsVal * 0.15;
        const c2 = phaseCosts.structure ? phaseCosts.structure * 0.5 : 0;
        const q3 = builtAreaVal;
        const c3 = phaseCosts.structure ? phaseCosts.structure * 0.5 : 0;
        const q4 = builtAreaVal * floorsVal * 0.8;
        const c4 = phaseCosts.finishing ? phaseCosts.finishing * 0.4 : 0;
        const q5 = builtAreaVal * 0.8;
        const c5 = phaseCosts.finishing ? phaseCosts.finishing * 0.4 : 0;
        const q6 = builtAreaVal * floorsVal * 0.2;
        const c6 = phaseCosts.painting ? phaseCosts.painting : 0;
        const q7 = builtAreaVal * floorsVal;
        const c7 = phaseCosts.tiling ? phaseCosts.tiling : 0;
        const q8 = builtAreaVal * floorsVal * 0.15;
        const c8 = phaseCosts.finishing ? phaseCosts.finishing * 0.2 : 0;
        const q9 = builtAreaVal * floorsVal * 0.05;
        const c9 = phaseCosts.electrical ? phaseCosts.electrical : 0;
        const q10 = builtAreaVal * floorsVal * 0.5;
        const c10 = phaseCosts.finishing ? phaseCosts.finishing : 0;

        const detailedElements = [
          { element: "ุงูููุงุนุฏ", quantity: q1.toFixed(2), cost: c1.toLocaleString() + " " + currency },
          { element: "ุงูุนูุฏุงู", quantity: q2.toFixed(2), cost: c2.toLocaleString() + " " + currency },
          { element: "ุงูุฃุณุทุญ", quantity: q3.toFixed(2), cost: c3.toLocaleString() + " " + currency },
          { element: "ุงูุฌุฏุฑุงู ุงูุฏุงุฎููุฉ", quantity: q4.toFixed(2), cost: c4.toLocaleString() + " " + currency },
          { element: "ุงูุฌุฏุฑุงู ุงูุฎุงุฑุฌูุฉ", quantity: q5.toFixed(2), cost: c5.toLocaleString() + " " + currency },
          { element: "ุฃุนูุงู ุงูุชูุงุจูุณ ูุงูุฑูุฌ", quantity: q6.toFixed(2), cost: c6.toLocaleString() + " " + currency },
          { element: "ุฃุนูุงู ุงูุจูุงุท", quantity: q7.toFixed(2), cost: c7.toLocaleString() + " " + currency },
          { element: "ุฃุนูุงู ุงูุตุญูุงุช ูุงูุนูุงุฒู", quantity: q8.toFixed(2), cost: c8.toLocaleString() + " " + currency },
          { element: "ุฃุนูุงู ุงูููุฑุจุงุก", quantity: q9.toFixed(2), cost: c9.toLocaleString() + " " + currency },
          { element: "ุงูุชุดุทูุจุงุช", quantity: q10.toFixed(2), cost: c10.toLocaleString() + " " + currency }
        ];
        detailedElementsTableBody.innerHTML = detailedElements.map(item => `
          <tr>
            <td>${item.element}</td>
            <td>${item.quantity}</td>
            <td>${item.cost}</td>
          </tr>
        `).join("");
      }

      function updateSummary(totalCost, builtArea, currency, exchangeRate) {
        let totalCostYER, totalCostUSD;
        if (currency === 'YER') {
          totalCostYER = totalCost;
          totalCostUSD = totalCost / exchangeRate;
        } else {
          totalCostUSD = totalCost;
          totalCostYER = totalCost * exchangeRate;
        }
        summaryTotalYEREl.innerText = `ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ (ุฑูุงู): ${totalCostYER.toLocaleString()} ุฑูุงู`;
        summaryTotalUSDEl.innerText = `ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ (ุฏููุงุฑ): ${totalCostUSD.toLocaleString()} ุฏููุงุฑ`;
        const costPerSqYER = totalCostYER / builtArea;
        const costPerSqUSD = totalCostUSD / builtArea;
        summaryCostPerSqYEREl.innerText = `ุชูููุฉ ุงููุชุฑ ุงููุงุญุฏ (ุฑูุงู): ${costPerSqYER.toLocaleString()} ุฑูุงู/ูยฒ`;
        summaryCostPerSqUSDEl.innerText = `ุชูููุฉ ุงููุชุฑ ุงููุงุญุฏ (ุฏููุงุฑ): ${costPerSqUSD.toLocaleString()} ุฏููุงุฑ/ูยฒ`;
      }

      function updateExtraChart1(phaseCosts, currency) {
        const ctx = extraChart1Canvas.getContext('2d');
        const labels = Object.keys(phaseCosts).map(key => {
          const map = {
            foundation: "ุงูุฃุณุงุณุงุช",
            structure: "ุงููููู",
            finishing: "ุงูุชุดุทูุจุงุช",
            electrical: "ุงูููุฑุจุงุก",
            plumbing: "ุงูุณุจุงูุฉ",
            painting: "ุงูุฏูุงู",
            tiling: "ุงูุจูุงุท",
            doors: "ุงูุฃุจูุงุจ",
            windows: "ุงูููุงูุฐ",
            flooring: "ุงูุฃุฑุถูุงุช",
            basement: "ุงููุจู"
          };
          return map[key] || key;
        });
        const dataValues = Object.values(phaseCosts);
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: `ุชูุงููู ุงููุฑุงุญู (${currency})`,
              data: dataValues,
              backgroundColor: [
                '#3498db', '#e74c3c', '#f1c40f', '#2ecc71', '#9b59b6',
                '#e67e22', '#1abc9c', '#34495e', '#16a085', '#d35400'
              ]
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
              title: { display: true, text: `ุงูุชูุงููู ุญุณุจ ุงููุฑุงุญู (${currency})` }
            },
            scales: {
              y: { beginAtZero: true },
              x: {}
            }
          }
        });
      }

      function updateExtraChart2(phaseCosts, currency) {
        const ctx = extraChart2Canvas.getContext('2d');
        const labels = Object.keys(phaseCosts).map(key => {
          const map = {
            foundation: "ุงูุฃุณุงุณุงุช",
            structure: "ุงููููู",
            finishing: "ุงูุชุดุทูุจุงุช",
            electrical: "ุงูููุฑุจุงุก",
            plumbing: "ุงูุณุจุงูุฉ",
            painting: "ุงูุฏูุงู",
            tiling: "ุงูุจูุงุท",
            doors: "ุงูุฃุจูุงุจ",
            windows: "ุงูููุงูุฐ",
            flooring: "ุงูุฃุฑุถูุงุช",
            basement: "ุงููุจู"
          };
          return map[key] || key;
        });
        const dataValues = Object.values(phaseCosts);
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [{
              label: `ุชุทูุฑ ุงูุชูุงููู (${currency})`,
              data: dataValues,
              borderColor: '#8e44ad',
              backgroundColor: 'rgba(142, 68, 173, 0.2)',
              fill: true,
              tension: 0.3
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: true },
              title: { display: true, text: `ุชุทูุฑ ุงูุชูุงููู (${currency})` }
            },
            scales: {
              y: { beginAtZero: true },
              x: {}
            }
          }
        });
      }

      function updateExtraChart3(phaseCosts, currency) {
        const ctx = extraChart3Canvas.getContext('2d');
        const labels = Object.keys(phaseCosts).map(key => {
          const map = {
            foundation: "ุงูุฃุณุงุณุงุช",
            structure: "ุงููููู",
            finishing: "ุงูุชุดุทูุจุงุช",
            electrical: "ุงูููุฑุจุงุก",
            plumbing: "ุงูุณุจุงูุฉ",
            painting: "ุงูุฏูุงู",
            tiling: "ุงูุจูุงุท",
            doors: "ุงูุฃุจูุงุจ",
            windows: "ุงูููุงูุฐ",
            flooring: "ุงูุฃุฑุถูุงุช",
            basement: "ุงููุจู"
          };
          return map[key] || key;
        });
        const dataValues = Object.values(phaseCosts);
        new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: labels,
            datasets: [{
              label: `ูุณุจุฉ ุงูุชูุงููู (${currency})`,
              data: dataValues,
              backgroundColor: [
                '#1abc9c', '#2ecc71', '#3498db', '#9b59b6', '#34495e',
                '#e74c3c', '#e67e22', '#f1c40f', '#16a085', '#d35400'
              ]
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { position: 'bottom' },
              title: { display: true, text: `ูุณุจุฉ ุงูุชูุงููู (${currency})` }
            }
          }
        });
      }

      function updateExtraChart4(phaseCosts, currency) {
        const ctx = extraChart4Canvas.getContext('2d');
        const labels = Object.keys(phaseCosts).map(key => {
          const map = {
            foundation: "ุงูุฃุณุงุณุงุช",
            structure: "ุงููููู",
            finishing: "ุงูุชุดุทูุจุงุช",
            electrical: "ุงูููุฑุจุงุก",
            plumbing: "ุงูุณุจุงูุฉ",
            painting: "ุงูุฏูุงู",
            tiling: "ุงูุจูุงุท",
            doors: "ุงูุฃุจูุงุจ",
            windows: "ุงูููุงูุฐ",
            flooring: "ุงูุฃุฑุถูุงุช",
            basement: "ุงููุจู"
          };
          return map[key] || key;
        });
        const dataValues = Object.values(phaseCosts);
        new Chart(ctx, {
          type: 'radar',
          data: {
            labels: labels,
            datasets: [{
              label: `ุงูููุงุฑูุฉ (${currency})`,
              data: dataValues,
              backgroundColor: 'rgba(231, 76, 60, 0.2)',
              borderColor: '#e74c3c',
              pointBackgroundColor: '#e74c3c'
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: true },
              title: { display: true, text: `ุงูููุงุฑูุฉ ุจูู ุงููุฑุงุญู (${currency})` }
            },
            scales: {
              r: { beginAtZero: true }
            }
          }
        });
      }

      function updateAllExtraCharts(phaseCosts, currency) {
        updateExtraChart1(phaseCosts, currency);
        updateExtraChart2(phaseCosts, currency);
        updateExtraChart3(phaseCosts, currency);
        updateExtraChart4(phaseCosts, currency);
      }

      function shareOnWhatsApp() {
        const message = `ุญุงุณุจุฉ ุงูุจูุงุก - ${totalCostEl.innerText}\n\n${window.location.href}`;
        const url = `https://api.whatsapp.com/send?text=${encodeURIComponent(message)}`;
        window.open(url, '_blank');
      }

      function downloadExcel() {
        const totalCostText = totalCostEl.innerText;
        const detailsText = costDetailsEl.innerText;
        const quantitiesText = document.getElementById('quantityTable').innerText;
        const phaseCostsText = document.getElementById('phaseCostTable').innerText;
        const data = [
          ["ุงูุชูููุฉ ุงูุฅุฌูุงููุฉ", totalCostText],
          ["ุชูุงุตูู ุงูุชูููุฉ", detailsText],
          ["ุงููููุงุช ุงููุทููุจุฉ", quantitiesText],
          ["ุชูููุฉ ูู ูุฑุญูุฉ", phaseCostsText]
        ];
        const ws = XLSX.utils.aoa_to_sheet(data);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "ุงููุชูุฌุฉ");
        XLSX.writeFile(wb, "ุญุงุณุจุฉ_ุงูุจูุงุก.xlsx");
      }

      function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFontSize(16);
        doc.text("ุชูุฑูุฑ ุญุงุณุจุฉ ุงูุจูุงุก", 105, 20, { align: "center" });
        doc.setFontSize(12);
        doc.text(totalCostEl.innerText, 105, 30, { align: "center" });
        doc.text("ุชูุงุตูู ุงูุชูููุฉ:", 20, 50);
        doc.text(costDetailsEl.innerText, 20, 60);
        doc.save("ุชูุฑูุฑ_ุญุงุณุจุฉ_ุงูุจูุงุก.pdf");
      }

      function saveCalculation(calcData) {
        let history = JSON.parse(localStorage.getItem('calcHistory')) || [];
        history.unshift(calcData);
        if (history.length > 10) history = history.slice(0, 10);
        localStorage.setItem('calcHistory', JSON.stringify(history));
        updateHistoryList();
      }

      function updateHistoryList() {
        const historyList = document.getElementById('historyList');
        const history = JSON.parse(localStorage.getItem('calcHistory')) || [];
        if (history.length === 0) {
          historyList.innerHTML = "<li>ูุง ุชูุฌุฏ ุญุณุงุจุงุช ูุญููุธุฉ.</li>";
        } else {
          historyList.innerHTML = history.map(item =>
            `<li>[${item.timestamp}] ูุดุฑูุน: ${item.projectName} - ุงูุชูููุฉ: ${item.totalCost ? item.totalCost.toLocaleString() : ''}</li>`
          ).join("");
        }
      }

      function resetForm() {
        projectNameEl.value = "";
        builtAreaEl.value = "";
        floorsEl.value = "";
        exchangeRateEl.value = "";
        totalCostEl.innerText = "";
        costDetailsEl.innerHTML = "";
        quantityTableBody.innerHTML = "";
        phaseCostTableBody.innerHTML = "";
        manualPriceTableBody.innerHTML = "";
        manualTotalCostEl.innerText = "0";
        if (costChart) {
          costChart.destroy();
          costChart = null;
        }
      }

      saveAdvancedBtn.addEventListener('click', () => {
        alert("ุชู ุญูุธ ุชูุงุตูู ุงููุดุฑูุน ุงููุชูุฏูุฉ ุจูุฌุงุญ.");
      });

      calculateBtn.addEventListener('click', calculateCost);
      resetBtn.addEventListener('click', resetForm);
      calculateManualBtn.addEventListener('click', calculateManualCost);
      shareBtn.addEventListener('click', shareOnWhatsApp);
      printBtn.addEventListener('click', () => window.print());
      downloadBtn.addEventListener('click', downloadExcel);
      generatePDFBtn.addEventListener('click', generatePDF);
      document.getElementById('clearHistoryBtn').addEventListener('click', () => {
        localStorage.removeItem('calcHistory');
        updateHistoryList();
      });

      // ุฅุตูุงุญ ุฒุฑ ุงููุถุน ุงููููู
      const darkModeToggle = document.getElementById('darkModeToggle');
      darkModeToggle.addEventListener('click', function() {
        document.body.classList.toggle('dark-mode');
        const icon = this.querySelector('.icon');
        const title = this.querySelector('.title');
        if (document.body.classList.contains('dark-mode')) {
          icon.innerText = "โ๏ธ";
          title.innerText = currentLanguage === 'ar' ? "ุงููุถุน ุงูููุงุฑู" : "Light Mode";
        } else {
          icon.innerText = "๐";
          title.innerText = currentLanguage === 'ar' ? "ุงููุถุน ุงููููู" : "Dark Mode";
        }
      });

      // ุชูุนูู ุฒุฑ ุชุจุฏูู ุงููุบุฉ
      const languageToggle = document.getElementById('languageToggle');
      languageToggle.addEventListener('click', toggleLanguage);

      fetchPrices();
      updateHistoryList();
      // ุชุทุจูู ุงูุชุฑุฌูุฉ ุนูุฏ ุจุฏุก ุงูุชุดุบูู
      translatePage();
    });
  </script>
</body>
</html>
